require("util");

module.exports.create = function(dep) {
    dep.db.collection('users').ensureIndex({'email': 1},{unique:true}, function(err, replies){});

    dep.db.bind('users', {
        findByName: function(name, fn) {
            this.findOne({name: name}, fn);
        },
        findByEmail: function(email, fn) {
            this.findOne({email: email}, fn);
        }
    });

    return function(app) {
        app.get('/my/:name', function(req, res, next) {
            var user = dep.db.collection('users').findByName('Andreas Prudzilko', function(err, user) {
                res.json(user);
            });
        });
    };
};

