// filter for use with Connect
var exports = module.exports = function(rules){
    return function(req, res, next){
        if (exports.filter(rules, req)) {
            next();
        } else {
            res.unauthorized('Unauthorized access');
        }
    };
};

exports.filter = function(rules, req){
    for(var i = 0; i < rules.always.length; i++) {
        var res = rules.always[i].test(req.url);
        if (res) return true;
    }
    return rules.onlyIf(req);
};

